# План реализации бэкенда для сервиса "Playmatch"

Этот документ описывает стратегию разработки, технологический стек и этапы реализации бэкенд-части проекта "Playmatch" на языке Go.

---

## 1. Сбор дополнительных требований

Перед началом разработки необходимо уточнить и детализировать следующие моменты:

- **Модели данных:**
  - **Пользователь (User):** Какие поля обязательны при регистрации (логин, email, пароль)? Какие данные храним из Steam?
  - **Игра (Game):** Полный список атрибутов (название, описание, изображение, жанры, теги).
  - **Лобби (Lobby):** Структура данных (хост, игра, макс. участников, текущие участники, статус).
  - **Репутация (Reputation):** Конкретные шкалы для оценки ("хард-скиллы" и "софт-скиллы"). Как рассчитывается и отображается итоговый рейтинг?
- **Интеграция со Steam:**
  - Нужен ли OAuth для входа через Steam или достаточно привязки профиля по ссылке?
  - Какие именно данные парсим со страницы игры? Только основные (название, картинка) или расширенные (жанры, теги)?
- **Real-time компоненты:**
  - Какие события должны обновляться в реальном времени (статус лобби, новые сообщения в чате)?
- **Администрирование:**
  - Какие инструменты нужны для управления системой (добавление тегов к играм, модерация)?

---

## 2. Предлагаемый технологический стек

- **Язык программирования:** **Go** (согласно требованию).
- **Веб-фреймворк:** **Gin Gonic**. Это легковесный и производительный фреймворк с удобной маршрутизацией и поддержкой middleware, что идеально подходит для создания REST API.
- **База данных:** **PostgreSQL**. Это мощная реляционная СУБД, которая хорошо подходит для структурированных данных (пользователи, игры, связи).
- **ORM:** **GORM**. Популярная библиотека для работы с базой данных, упрощает выполнение CRUD-операций и миграций.
- **Real-time:** **Gorilla WebSocket**. Стандартная и надежная библиотека для реализации WebSocket-соединений для чатов и обновлений статуса лобби.
- **Аутентификация:** **JWT (JSON Web Tokens)**. Стандарт для создания токенов доступа, которые будут использоваться для защиты API-эндпоинтов.
- **Контейнеризация:** **Docker** и **Docker Compose**. Для создания изолированных и воспроизводимых окружений для разработки и развертывания приложения и базы данных.
- **Конфигурация:** **Viper**. Библиотека для управления конфигурацией приложения (например, через переменные окружения или файлы).

---

## 3. Архитектура и структура проекта

Предлагается начать с **модульного монолита**. Этот подход проще в разработке и развертывании на начальном этапе, но оставляет возможность для разделения на микросервисы в будущем.

**Структура проекта:**

```
/cmd
  /server         # Точка входа в приложение
    - main.go
/internal
  /config         # Конфигурация
  /handler        # Обработчики HTTP-запросов (контроллеры)
  /repository     # Логика работы с базой данных
  /service        # Бизнес-логика
  /models         # Структуры данных (User, Game, Lobby)
/pkg
  /jwt            # Утилиты для работы с JWT
  /steam_parser   # Логика парсинга данных из Steam
/api              # Спецификации API (Swagger/OpenAPI)
```

---

## 4. Этапы разработки (Roadmap)

### Этап 1: Ядро системы и пользователи
1.  **Настройка окружения:** Инициализация Go-модуля, подключение Gin, настройка Docker Compose для запуска приложения и PostgreSQL.
2.  **Создание миграций:** Разработка миграций для базовых таблиц (users, games).
3.  **Реализация API пользователей:**
    - Регистрация и авторизация (login/password).
    - Генерация и проверка JWT-токенов.
    - Создание и редактирование профиля пользователя.

### Этап 2: Управление играми
1.  **Реализация API игр:**
    - CRUD-операции для игр (для администратора).
    - Эндпоинт для получения списка игр с фильтрацией.
2.  **Разработка парсера Steam:**
    - Создание сервиса, который принимает URL игры в Steam и извлекает из него название, описание и изображение.
    - Эндпоинт для добавления игры по URL.

### Этаap 3: Система лобби и чат
1.  **Реализация API лобби:**
    - Создание, удаление, получение списка лобби.
    - Эндпоинты для входа и выхода из лобби.
    - Фильтрация лобби по играм.
2.  **Реализация WebSocket-чата:**
    - Настройка WebSocket-сервера.
    - Логика для создания комнаты чата при создании лобби.
    - Отправка и получение сообщений в реальном времени.

### Этап 4: Социальные функции
1.  **Реализация системы друзей:**
    - API для отправки, принятия и отклонения заявок в друзья.
    - Эндпоинт для получения списка друзей.
2.  **Реализация системы репутации:**
    - Проектирование таблиц в БД для хранения оценок.
    - API для оценки других пользователей после совместной игры.
    - Расчёт и отображение репутации в профиле.

### Этап 5: Завершение и развертывание
1.  **Тестирование:** Написание Unit- и интеграционных тестов.
2.  **Документация:** Описание эндпоинтов API с помощью Swagger/OpenAPI.
3.  **Подготовка к развертыванию:** Финальная настройка Dockerfile, логирование, обработка ошибок.

---

## Следующие шаги

1.  Обсудить и утвердить предложенный план и стек.
2.  Детализировать модели данных и API-контракты.
3.  Приступить к выполнению **Этапа 1**.
