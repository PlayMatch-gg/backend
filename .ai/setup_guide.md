# Руководство по настройке и запуску

Это руководство поможет быстро развернуть локальное окружение для разработки.

## Предварительные требования

1.  **Go:** Установленная последняя версия Go.
2.  **Docker** и **Docker Compose:** Для запуска базы данных и Adminer.

## Быстрый старт

1.  **Клонируйте репозиторий** (если еще не сделали).

2.  **Создайте файл конфигурации:**
    Скопируйте `.env.example` в `.env` или создайте `.env` вручную в корне проекта со следующим содержимым:

    ```env
    # .env
    # PostgreSQL connection string
    DATABASE_URL="host=localhost user=postgres password=postgres dbname=playmatch port=5432 sslmode=disable"

    # JWT Secret (для локальной разработки можно оставить таким)
    JWT_SECRET="a_very_secret_key_that_should_be_changed"
    ```
    *Примечание: База данных `playmatch` будет создана автоматически при первом запуске Docker-контейнера.*

3.  **Запустите Docker-сервисы (база данных и Adminer):**
    Выполните в терминале:
    ```bash
    make db-up
    ```
    Эта команда поднимет Docker-контейнеры с PostgreSQL и Adminer.

4.  **Запустите приложение:**
    ```bash
    make dev
    ```
    Эта команда сгенерирует актуальную Swagger-документацию и запустит веб-сервер на `localhost:8080`.

## Доступ к сервисам

*   **API:** `http://localhost:8080/api/v1`
*   **Swagger UI (интерактивная документация):** `http://localhost:8080/swagger/index.html`
*   **Adminer (веб-интерфейс БД):** `http://localhost:8081/`
    *   **Данные для входа в Adminer:**
        *   **System:** `PostgreSQL`
        *   **Server:** `db`
        *   **Username:** `postgres`
        *   **Password:** `postgres`
        *   **Database:** `playmatch`

## Дополнительные команды

*   **Перегенерация Swagger-документации:**
    Если вы внесли изменения в комментарии к эндпоинтам, выполните:
    ```bash
    make swag-gen
    ```
*   **Остановка всех Docker-сервисов:**
    ```bash
    make db-down
    ```

## Как сделать пользователя администратором

1.  Запустите Docker-сервисы (`make db-up`) и приложение (`make dev`).
2.  Зарегистрируйте обычного пользователя через API (`POST /api/v1/auth/register`).
3.  Откройте Adminer (http://localhost:8081/) и войдите в базу данных.
4.  В таблице `users` найдите зарегистрированного пользователя.
5.  Измените значение в колонке `role` для этого пользователя с `user` на `admin`.
6.  Сохраните изменения.
Теперь этот пользователь сможет получать доступ к административным эндпоинтам.
