# Соглашения по коду и архитектуре

## Структура проекта

Проект следует стандартной для Go структуре, разделяя код по его назначению:

*   `/cmd/server`: Точка входа приложения (`main.go`).
*   `/internal`: Внутренняя логика приложения, недоступная для импорта извне.
    *   `/auth`: Middleware для аутентификации.
    *   `/config`: Загрузка конфигурации.
    *   `/database`: Настройка подключения к БД и запуск миграций.
    *   `/handler`: Обработчики HTTP-запросов (контроллеры).
    *   `/models`: Структуры данных GORM (модели БД).
*   `/pkg`: Пакеты, которые можно безопасно импортировать (например, хелпер для JWT).
*   `/docs`: Сгенерированная Swagger-документация.
*   `/.ai`: Директория для хранения мета-информации о проекте.

## API

*   **Версионирование:** Все эндпоинты находятся под префиксом `/api/v1`.
*   **Аутентификация:** Используются Bearer-токены (JWT). Защищенные маршруты требуют заголовок `Authorization: Bearer <token>`.
*   **DTO (Data Transfer Objects):** В пакете `handler` определены структуры для входящих запросов (`...Input`) и исходящих ответов (`...Response`). Это позволяет отделить API-представление от модели базы данных.
    *   **`PublicUserResponse`**: Структура для публичных профилей, не содержит приватных данных (например, email).
    *   **`PrivateUserResponse`**: Структура для собственного профиля пользователя (`/users/me`), содержит приватные данные.

## База данных

*   **Миграции:** На данный момент используется `gorm.AutoMigrate()` для простоты разработки. Это автоматически создает и обновляет таблицы на основе GORM-моделей.
    *   **Примечание:** Для продакшн-среды следует перейти на полноценный инструмент миграций, например, `golang-migrate/migrate`.
*   **Модель отношений (Friendship):**
    *   Модель асимметрична. Связь `A -> B` со статусом `pending` означает, что A подписан на B (отправил заявку).
    *   Связь `A -> B` со статусом `accepted` означает, что A и B — друзья (по инициативе A).
    *   Взаимная дружба — это наличие двух `accepted` записей: `A -> B` и `B -> A`.
    *   Удаление "друга" B пользователем A означает удаление записи `A -> B`. При этом запись `B -> A` может остаться, что интерпретируется как "B все еще подписан на A".
